head
	link(rel="stylesheet", 
	href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700|Open+Sans:300,400,600,700")
	link(rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css")
	link(rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css' integrity='sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm' crossorigin='anonymous')

body
	style(scoped).
		body{
			margin:0px;
			padding:0px;
		}

		#editor{
			font-size: 12pt;
			min-width: 100%;
			min-height: 100vh;
		}
		.list-group-item span{
			font-size:12px;
		}
		.list-group-item span.tiny, textarea.tiny{
			font-size:8px;
		}
		textarea.tiny{
			height:25px;
		}
		.clipboard{
			width:100%;
			height:50px;
		}
		.name{
			min-width:230px;
		}
	#app

		.row.no-gutters
			.col-12.col-lg-6
				textarea.form-control.clipboard(@keyup="saveClipboard",v-model="clipboard")
			.col-12.col-lg-6
				ul.list-group
					li.list-group-item(v-for="item,key in items" v-bind:key="key",@click="select(item)")
						span(v-html="item.name")
						span.tiny.d-block(v-html="item.type")
			.col-12.col-lg-12
				.row.no-gutters
					.col
						button.form-control(v-on:click="save",v-bind:disabled="!canSave")='Save'
					.col
						input.form-control.name(v-model="item.name",placeholder="Name")
					.col
						input.form-control(v-model="item.type",placeholder="Type")
					.col
						input.form-control(v-model="item.path",placeholder="Path")
					.col
						button.form-control(@click="newItem") New
			.col-12
				textarea.tiny.form-control(disabled, v-html="resourceUrl")
		div#editor

	script(src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js")
	script(async src="https://pro.fontawesome.com/releases/v5.0.8/js/all.js")
	script(src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js')
	script(src='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js')
	script(src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.3/ace.js")
	script(src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.3/ext-language_tools.js")
	script(src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.7.5/beautify.min.js")
	script(src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.7.5/beautify-css.min.js")
	script(src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.0/moment.min.js")
	script(src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js")
	script(src="/js/common.js")
	script.
		new Vue({
			el: "#app",
			data: function() {
				return{
					items:[],
					clipboard:`||`,
					item:{
						_id:null,
						type:'vueComponent',
						name:'',
						path:'',
						code:''
					}
				}
			},
			methods:{
				newItem(){
					var self = this;
					Object.keys(this.item).forEach(k=>self.item[k]='');
					this.item.type= 'vueComponent'
					this.editor.setValue(this.item.code);
				},
				loadClipBoard(){
					this.clipboard = window.localStorage.getItem('simback_clipboard')||'||';
				},
				saveClipboard(){
					window.localStorage.setItem('simback_clipboard', this.clipboard);
				},
				select(item){
					Object.assign(this.item, item);
					this.editor.setValue(this.item.code);
				},
				save(){
					var self= this;
					httpPost('/rpc/save-file',this.item).then(r=>{
						self.updateItems();
						console.info(r);
					}).catch(console.warn);
					
				},
				updateItems(){
					var self= this;
					httpPost('/rpc/fetch/',{
						type:'vueComponent'
					}).then(data=>{
						self.items = data;
					}).catch(console.warn);
				}
			},
			computed:{
				resourceUrl(){
					return `https://simback.herokuapp.com/resource/${this.item.type}/${this.item.name}?ext=js`
				},
				canSave(){
					return !!this.item.name && !!this.item.code
				}
			},
			mounted(){
				var self = this;
				editor = self.editor = ace.edit("editor");
				editor.setTheme("ace/theme/monokai");
				editor.session.setMode('ace/mode/javascript');
				editor.session.setOptions({
					wrap: true,
					tabSize: 4,
					useSoftTabs: false
				});
				editor.setOptions({
					enableLiveAutocompletion: true,
					fontSize: "12pt",
					showPrintMargin: false
				});
				editor.on("change",data=>self.item.code=editor.getValue())
				self.updateItems();
				self.loadClipBoard();
			}
		});
